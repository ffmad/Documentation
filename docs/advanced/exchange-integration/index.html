<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.72">
<link rel="alternate" type="application/rss+xml" href="/Documentation/blog/rss.xml" title="Counterparty Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/Documentation/blog/atom.xml" title="Counterparty Blog Atom Feed"><title data-react-helmet="true">Exchange Integration | Counterparty</title><meta data-react-helmet="true" property="og:url" content="https://ffmad.github.io/Documentation/docs/advanced/exchange-integration"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Exchange Integration | Counterparty"><meta data-react-helmet="true" name="description" content="By adding support for Counterparty, your exchange not only gets XCP market support, but support for any other Counterparty asset such as Bitcrystals) or FoldingCoin."><meta data-react-helmet="true" property="og:description" content="By adding support for Counterparty, your exchange not only gets XCP market support, but support for any other Counterparty asset such as Bitcrystals) or FoldingCoin."><link data-react-helmet="true" rel="shortcut icon" href="/Documentation/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://ffmad.github.io/Documentation/docs/advanced/exchange-integration"><link data-react-helmet="true" rel="alternate" href="https://ffmad.github.io/Documentation/docs/advanced/exchange-integration" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://ffmad.github.io/Documentation/docs/advanced/exchange-integration" hreflang="x-default"><link rel="stylesheet" href="/Documentation/assets/css/styles.5136cec4.css">
<link rel="preload" href="/Documentation/assets/js/styles.3bec8e7c.js" as="script">
<link rel="preload" href="/Documentation/assets/js/runtime~main.29403df5.js" as="script">
<link rel="preload" href="/Documentation/assets/js/main.df58b352.js" as="script">
<link rel="preload" href="/Documentation/assets/js/1.d5f96000.js" as="script">
<link rel="preload" href="/Documentation/assets/js/2.51cf87d3.js" as="script">
<link rel="preload" href="/Documentation/assets/js/55.4d55144e.js" as="script">
<link rel="preload" href="/Documentation/assets/js/56.1e9741af.js" as="script">
<link rel="preload" href="/Documentation/assets/js/935f2afb.02d65049.js" as="script">
<link rel="preload" href="/Documentation/assets/js/17896441.cde37ae1.js" as="script">
<link rel="preload" href="/Documentation/assets/js/2ee84cfa.e6afcfbf.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/Documentation/"><img src="/Documentation/img/xcp.png" alt="Counterparty" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/Documentation/img/xcp.png" alt="Counterparty" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Counterparty</strong></a><a class="navbar__item navbar__link" href="/Documentation/docs/basics/what-is-counterparty/a-bitcoin-protocol">Basics</a><a class="navbar__item navbar__link" href="/Documentation/docs/wallets/counterwallet">Wallets</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/Documentation/docs/advanced/architecture">Advanced</a><a class="navbar__item navbar__link" href="/Documentation/docs/develop/api/overview">Develop</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/CounterpartyXCP/Documentation" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_GrZ2"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/Documentation/"><img src="/Documentation/img/xcp.png" alt="Counterparty" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/Documentation/img/xcp.png" alt="Counterparty" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Counterparty</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/Documentation/docs/basics/what-is-counterparty/a-bitcoin-protocol">Basics</a></li><li class="menu__list-item"><a class="menu__link" href="/Documentation/docs/wallets/counterwallet">Wallets</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/Documentation/docs/advanced/architecture">Advanced</a></li><li class="menu__list-item"><a class="menu__link" href="/Documentation/docs/develop/api/overview">Develop</a></li><li class="menu__list-item"><a href="https://github.com/CounterpartyXCP/Documentation" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper main-docs-wrapper"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/Documentation/docs/advanced/architecture">Platform Architecture</a></li><li class="menu__list-item"><a class="menu__link" href="/Documentation/docs/advanced/protocol">Protocol Specification</a></li><li class="menu__list-item"><a class="menu__link" href="/Documentation/docs/advanced/cli">Command-line (CLI) Guide</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Advanced Usage</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Documentation/docs/advanced/advanced-usage/sending-bulk">How to send Counterparty assets in bulk</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Documentation/docs/advanced/advanced-usage/multisig">Using multisig with counterparty-server</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Federated Node</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Documentation/docs/advanced/federated-node/getting-started">Getting started</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Documentation/docs/advanced/federated-node/pre-installation">Pre-installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Documentation/docs/advanced/federated-node/installation">Installation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Documentation/docs/advanced/federated-node/administration">Node Administration</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Documentation/docs/advanced/federated-node/counterwallet">Counterwallet-Specific</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Installation</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Documentation/docs/advanced/installation/bitcoin-core">Bitcoin Core with ``addrindex`` Patch</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/Documentation/docs/advanced/installation/windows">Counterparty Dependencies on Windows</a></li></ul></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" href="/Documentation/docs/advanced/exchange-integration">Exchange Integration</a></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">Exchange Integration</h1></header><div class="markdown"><p>By adding support for Counterparty, your exchange not only gets <a href="http://coinmarketcap.com/currencies/counterparty/" target="_blank" rel="noopener noreferrer">XCP market</a> support, but support for any other Counterparty asset such as <a href="http://coinmarketcap.com/assets/bitcrystals/" target="_blank" rel="noopener noreferrer">Bitcrystals</a>) or <a href="https://coinmarketcap.com/currencies/foldingcoin/" target="_blank" rel="noopener noreferrer">FoldingCoin</a>.</p><p>Technically, the process is rather straightforward. However, as Counterparty is not a fork of Bitcoin Core, adding Counterparty support to your exchange is slightly different from adding support for a cryptocurrency that is, like Litecoin or Dogecoin.  We outline the general process below (for XCP, but the process is identical for all Counterparty assets):</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="basic-setup"></a>Basic Setup<a class="hash-link" href="#basic-setup" title="Direct link to heading">#</a></h2><ul><li><p>Follow the instructions <a href="http://counterparty.io/docs/federated_node/" target="_blank" rel="noopener noreferrer">here</a> to set up a full node. You can install the <code>base</code> configuration (e.g. <code>fednode install base master</code>)</p></li><li><p>Alternatively, you can install and configure manually. Those instructions are <a href="https://github.com/CounterpartyXCP/counterparty-lib/blob/develop/README.md#manual-installation" target="_blank" rel="noopener noreferrer">here</a>.</p></li><li><p>Once the system is set up, get started working with <code>counterparty-server</code>&#x27;s <a href="/Documentation/docs/develop/api/api">API</a>.</p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="handling-deposits-using-separate-addresses"></a>Handling Deposits using Separate Addresses<a class="hash-link" href="#handling-deposits-using-separate-addresses" title="Direct link to heading">#</a></h2><ul><li><p>Create a XCP holding address (or several primary XCP holding addresses). The address will hold deposited XCP funds for all users using the exchange.</p></li><li><p>Create a regular Bitcoin address for each user wanting to deposit XCP using the API of the Bitcoin Core instance that <code>counterparty-server</code> is connecting to.</p></li><li><p>Poll for deposits using <code>get_sends</code> <a href="/Documentation/docs/develop/api/api">API method</a>, filtering for <code>asset==XCP</code>, <code>destination==deposit_address</code> and <code>block_index&lt;=current_block_index-number_of_desired_confirmations</code>. Record the quantity of the send transaction and the transaction&#x27;s <code>txid</code>.</p></li><li><p>&#x27;Prime&#x27; the deposit address by sending it 0.0005 BTC.</p></li><li><p>For deposit, send the quantity deposited to the holding address using the <code>do_send</code> <a href="/Documentation/docs/develop/api/api">API method</a> with the flag <code>unconfirmed=True</code> (so you don&#x27;t have to wait for the priming to confirm). Record the <code>txid</code> of this transaction.</p></li><li><p>When the second send is confirmed (poll <code>get_sends</code> again), credit the userâ€™s account balance.</p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="handling-deposits-using-memo-transactions"></a>Handling Deposits using Memo Transactions<a class="hash-link" href="#handling-deposits-using-memo-transactions" title="Direct link to heading">#</a></h2><ul><li><p>Create a XCP deposit address. The address will hold deposited XCP funds for all users using the exchange.</p></li><li><p>&#x27;Prime&#x27; the deposit address by sending it 0.001 BTC.</p></li><li><p>Make the deposit address require a memo by <a href="/Documentation/docs/develop/api/api#create_broadcast">broadcasting</a> <code>OPTIONS 1</code> from that address.  The value and fee_fraction can be 0.</p></li><li><p>When a user wishes to deposit to your exchange, generate a unique hexadecimal invoice ID for the deposit and convey that to the user.  The user must send counterparty assets into the address along with the matching invoice ID in the memo field.  If the user fails to include a memo, the send will be rejected by the network and the user&#x27;s address will retain the assets they sent.</p></li><li><p>Poll for deposits using <code>get_sends</code> <a href="/Documentation/docs/develop/api/api">API method</a>, filtering for <code>asset==XCP</code>, <code>destination==deposit_address</code> and <code>block_index&lt;={current_block_index-number_of_desired_confirmations}</code> and <code>memo_hex=={invoice_id}</code>. Record the quantity of the send transaction and the transaction&#x27;s <code>txid</code>.</p></li><li><p>When the send is confirmed with 2 confirmations (poll <code>get_sends</code> again), credit the userâ€™s account balance.</p></li><li><p>Memo transactions are available as of block 489956</p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="handling-withdrawals-single-send"></a>Handling Withdrawals (Single Send)<a class="hash-link" href="#handling-withdrawals-single-send" title="Direct link to heading">#</a></h2><ul><li><p>Prime the holding address if its current balance is below 0.0005 BTC.</p></li><li><p>Send the funds to the user-provided address with <code>create_send</code> (Counterparty API).</p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="batching-withdrawals-multi-peer-multi-asset-send"></a>Batching Withdrawals (Multi-Peer-Multi-Asset Send)<a class="hash-link" href="#batching-withdrawals-multi-peer-multi-asset-send" title="Direct link to heading">#</a></h2><ul><li><p>Prime the holding address if its current balance is below 0.0005 BTC.</p></li><li><p>Generate first MPMA transaction by making a <code>create_send</code> (Counterparty API) call and specify as many assets and recipient addresses as you would like.</p></li><li><p>Sign and Broadcast first MPMA transaction and note <code>txid</code></p></li><li><p>Generate second MPMA transaction by making identical <code>create_send</code> (Counterparty API) call as before, except also specify <code>p2sh_pretx_txid</code> param and give <code>txid</code> of first MPMA transaction</p></li><li><p>Sign and Broadcast second MPMA transaction</p></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="best-practices"></a>Best practices<a class="hash-link" href="#best-practices" title="Direct link to heading">#</a></h2><ul><li><p>For deposits, wait for at least two confirmations on the send to the desposit address and one confirmation for the send to the holding address.</p></li><li><p>Keep the private key for the holding address secret and safe.</p></li><li><p>Keep the bulk of your exchange&#x27;s funds in cold storage.</p></li><li><p>Set a maximum XCP and BTC withdrawal amount, both per day and per event.</p></li><li><p>Use a segwit address for memo deposits and MPMA/Batched withdrawals to keep transaction costs minimal.</p></li></ul></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/master/website/docs/advanced/exchange-integration.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/Documentation/docs/advanced/installation/windows"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Counterparty Dependencies on Windows</div></a></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#basic-setup" class="table-of-contents__link">Basic Setup</a></li><li><a href="#handling-deposits-using-separate-addresses" class="table-of-contents__link">Handling Deposits using Separate Addresses</a></li><li><a href="#handling-deposits-using-memo-transactions" class="table-of-contents__link">Handling Deposits using Memo Transactions</a></li><li><a href="#handling-withdrawals-single-send" class="table-of-contents__link">Handling Withdrawals (Single Send)</a></li><li><a href="#batching-withdrawals-multi-peer-multi-asset-send" class="table-of-contents__link">Batching Withdrawals (Multi-Peer-Multi-Asset Send)</a></li><li><a href="#best-practices" class="table-of-contents__link">Best practices</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/Documentation/docs/basics/what-is-counterparty/a-bitcoin-protocol">Getting Started</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://discord.gg/wsjKtPGrMF" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="https://counterpartytalk.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Forum</a></li><li class="footer__item"><a href="https://www.reddit.com/r/counterparty_xcp/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Reddit</a></li><li class="footer__item"><a href="https://t.me/Counterparty_XCP" target="_blank" rel="noopener noreferrer" class="footer__link-item">Telegram</a></li><li class="footer__item"><a href="https://twitter.com/CounterpartyXCP" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/CounterpartyXCP/Documentation" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2014 - 2021 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/Documentation/assets/js/styles.3bec8e7c.js"></script>
<script src="/Documentation/assets/js/runtime~main.29403df5.js"></script>
<script src="/Documentation/assets/js/main.df58b352.js"></script>
<script src="/Documentation/assets/js/1.d5f96000.js"></script>
<script src="/Documentation/assets/js/2.51cf87d3.js"></script>
<script src="/Documentation/assets/js/55.4d55144e.js"></script>
<script src="/Documentation/assets/js/56.1e9741af.js"></script>
<script src="/Documentation/assets/js/935f2afb.02d65049.js"></script>
<script src="/Documentation/assets/js/17896441.cde37ae1.js"></script>
<script src="/Documentation/assets/js/2ee84cfa.e6afcfbf.js"></script>
</body>
</html>