<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.72">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Counterparty Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Counterparty Blog Atom Feed"><title data-react-helmet="true">Writing counterblock Plug-in Modules | Counterparty</title><meta data-react-helmet="true" property="og:url" content="https://ffmad.github.io/docs/develop/counterblock/modules"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Writing counterblock Plug-in Modules | Counterparty"><meta data-react-helmet="true" name="description" content="`counterblock` is a modular application that allows developers to turn on or off various bits of its out-of-the-box functionality, as well as extending it with new functionality, through its plug-in architecture."><meta data-react-helmet="true" property="og:description" content="`counterblock` is a modular application that allows developers to turn on or off various bits of its out-of-the-box functionality, as well as extending it with new functionality, through its plug-in architecture."><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://ffmad.github.io/docs/develop/counterblock/modules"><link data-react-helmet="true" rel="alternate" href="https://ffmad.github.io/docs/develop/counterblock/modules" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://ffmad.github.io/docs/develop/counterblock/modules" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.5136cec4.css">
<link rel="preload" href="/assets/js/styles.3bec8e7c.js" as="script">
<link rel="preload" href="/assets/js/runtime~main.85ef5a3f.js" as="script">
<link rel="preload" href="/assets/js/main.9a984a6f.js" as="script">
<link rel="preload" href="/assets/js/1.d5f96000.js" as="script">
<link rel="preload" href="/assets/js/2.51cf87d3.js" as="script">
<link rel="preload" href="/assets/js/55.4d55144e.js" as="script">
<link rel="preload" href="/assets/js/56.1e9741af.js" as="script">
<link rel="preload" href="/assets/js/935f2afb.912e5501.js" as="script">
<link rel="preload" href="/assets/js/17896441.cde37ae1.js" as="script">
<link rel="preload" href="/assets/js/428d4327.b897686b.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/xcp.png" alt="Counterparty" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/xcp.png" alt="Counterparty" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Counterparty</strong></a><a class="navbar__item navbar__link" href="/docs/basics/what-is-counterparty/a-bitcoin-protocol">Basics</a><a class="navbar__item navbar__link" href="/docs/wallets/counterwallet">Wallets</a><a class="navbar__item navbar__link" href="/docs/advanced/architecture">Advanced</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/develop/api/overview">Develop</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/CounterpartyXCP/Documentation" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_GrZ2"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/xcp.png" alt="Counterparty" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/xcp.png" alt="Counterparty" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">Counterparty</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/basics/what-is-counterparty/a-bitcoin-protocol">Basics</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/wallets/counterwallet">Wallets</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/advanced/architecture">Advanced</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs/develop/api/overview">Develop</a></li><li class="menu__list-item"><a href="https://github.com/CounterpartyXCP/Documentation" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper main-docs-wrapper"><div class="docPage_31aa"><div class="docSidebarContainer_3Kbt" role="complementary"><div class="sidebar_15mo"><div class="menu menu--responsive thin-scrollbar menu_Bmed"><button aria-label="Open menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_fgN0" width="24" height="24" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Counterparty API</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/develop/api/overview">Overview</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/develop/api/api">Technical Specification</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/develop/api/api-changes">API Changes</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Counterblock</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/docs/develop/counterblock/api">Counterblock API</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/develop/counterblock/modules">Writing counterblock Plug-in Modules</a></li></ul></li><li class="menu__list-item"><a class="menu__link" href="/docs/develop/contributing">Contributing</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/develop/bounties">Bug Bounties</a></li></ul></div></div></div><main class="docMainContainer_3ufF"><div class="container padding-vert--lg docItemWrapper_3FMP"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><header><h1 class="docTitle_3a4h">Writing counterblock Plug-in Modules</h1></header><div class="markdown"><p><code>counterblock</code> is a modular application that allows developers to turn on or off various bits of its out-of-the-box functionality, as well as extending it with new functionality, through its plug-in architecture.</p><p>This document introduces the built-in modules, as well as discussing how you can write your own custom modules for <code>counterblock</code> that extend its functionality beyond what is possible out of the box.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="built-in-modules"></a>Built-in Modules<a class="hash-link" href="#built-in-modules" title="Direct link to heading">#</a></h2><p><code>counterblock</code> ships with the following built-in modules:</p><ul><li><code>assets</code>: Implements basic asset functionality, such as extended asset info parsing, basic asset-related APIs, and more.</li><li><code>betting</code>: Implements betting-specific API calls, tasks, and more.</li><li><code>dex</code>: Implements API methods, order book and market info parsing, and more for Counterparty&#x27;s distributed exchange. (Requires that the <code>assets</code> module be loaded for use.)</li><li><code>transaction_stats</code>: Handles the compliation of transaction statistics.</li><li><code>counterwallet</code>: Implements Counterwallet-specific API calls, tasks, and more. (Requires that the <code>assets</code> module be loaded for use.)</li></ul><p>Any of these above modules may be enabled or disabled, allowing you to tune <code>counterblock</code> to your exact needs out of the box.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="custom-module-development"></a>Custom Module Development<a class="hash-link" href="#custom-module-development" title="Direct link to heading">#</a></h2><p>A <code>counterblock</code> module is simply a python module that utilizes a special plug-in API, to provide runtime integration into the <code>counterblock</code> base code.</p><p>For some examples of modules in use, check out the <a href="https://github.com/CounterpartyXCP/counterblock/tree/master/counterblock/lib/modules" target="_blank" rel="noopener noreferrer">modules directory</a> of the <code>counterblock</code> respository. These built-in modules are written just like any custom module would be, and provide a good launching point to see what is possible.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="processors-hooking-into-runtime-functionality"></a>Processors: Hooking into runtime functionality<a class="hash-link" href="#processors-hooking-into-runtime-functionality" title="Direct link to heading">#</a></h3><p>Most of the API functionality follows a specific Python decorator type syntax, to integrate into things like blockchain message processing, block level processing, startup/initialization processing and more. The general syntax is:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><div tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> lib</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">processor </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> </span><span class="token operator">&lt;</span><span class="token plain">processor_name</span><span class="token operator">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    @</span><span class="token operator">&lt;</span><span class="token plain">processor_name</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">subscribe</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">enabled</span><span class="token operator">=</span><span class="token operator">&lt;</span><span class="token builtin" style="color:rgb(189, 147, 249)">bool</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> priority</span><span class="token operator">=</span><span class="token operator">&lt;</span><span class="token builtin" style="color:rgb(189, 147, 249)">int</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">my_function</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">param1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> param2</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        bla </span><span class="token operator">=</span><span class="token plain"> do_foo</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Some other notes on processors:</p><ul><li>If not specified, the defaults are <code>enabled=true, priority=0</code>.</li><li>When a processor is triggered methods are run in order of priority from highest to lowest.</li><li><em>Please note that any priority less than <code>0</code> or greater than <code>1000</code> is reserved for internal <code>counterblock</code>
functionality, and custom plugins should only utilize priority settings under this number.</em></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="messageprocessor"></a>MessageProcessor<a class="hash-link" href="#messageprocessor" title="Direct link to heading">#</a></h3><p><code>MessageProcessor</code> runs once for each message as obtained from the <code>counterpartyd</code> message feed, for all activity that has been confirmed on the blockchain (i.e. at least 1 Bitcoin confirmation). <code>msg</code> will pass the message in the same format as the <code>get_messages</code> counterpartyd api method, msg_data corresponds to <code>json.loads(msg[&#x27;bindings&#x27;])</code>. </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><div tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:rgb(248, 248, 242)">@MessageProcessor</span><span class="token decorator annotation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token decorator annotation punctuation" style="color:rgb(248, 248, 242)">subscribe</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">enabled</span><span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> priority</span><span class="token operator">=</span><span class="token number">90</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">custom_received_xcp_alert</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> msg_data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> msg</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;category&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">!=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;sends&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> message</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;status&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">!=</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;valid&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">not</span><span class="token plain"> msg_data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;destination&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> MY_ADDRESS_LIST</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">not</span><span class="token plain"> msg_data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;asset&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;XCP&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Received %s XCP at My Address %s from %s&#x27;</span><span class="token plain"> </span><span class="token operator">%</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token builtin" style="color:rgb(189, 147, 249)">float</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">msg_data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;quantity&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token operator">/</span><span class="token number">10</span><span class="token operator">**</span><span class="token number">8</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> msg_data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;destination&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> msg_data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;source&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Note that with <code>MessageProcessor</code> handlers, you can return <code>&#x27;ABORT_THIS_MESSAGE_PROCESSING&#x27;</code> to prevent the running of further MessageProcessors (i.e. of lesser priority than the current one) for the message being currently processed.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="mempoolmessageprocessor"></a>MempoolMessageProcessor<a class="hash-link" href="#mempoolmessageprocessor" title="Direct link to heading">#</a></h3><p><code>MempoolMessageProcessor</code> works similar to <code>MessageProcessor</code>, however, for messages out the mempool (i.e.
that are not confirmed and included on the blockchain yet). The format of the data supplied to the processor is slightly different though, and looks like this:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><div tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:rgb(248, 248, 242)">@MempoolMessageProcessor</span><span class="token decorator annotation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token decorator annotation punctuation" style="color:rgb(248, 248, 242)">subscribe</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">enabled</span><span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> priority</span><span class="token operator">=</span><span class="token number">90</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">custom_received_xcp_alert</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">msg</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> msg_data</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">assert</span><span class="token plain"> msg</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;_message_index&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;mempool&#x27;</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">assert</span><span class="token plain"> msg</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;tx_hash&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">assert</span><span class="token plain"> msg</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;command&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">assert</span><span class="token plain"> msg</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;category&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">assert</span><span class="token plain"> msg_data </span><span class="token comment" style="color:rgb(98, 114, 164)">#the actual message data</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">assert</span><span class="token plain"> msg</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;timestamp&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">assert</span><span class="token plain"> msg</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;viewed_in_block&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">#prevent running of further MempoolMessageProcessor&#x27;s of lesser priority for the message being processed</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;ABORT_THIS_MESSAGE_PROCESSING&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="blockprocessor"></a>BlockProcessor<a class="hash-link" href="#blockprocessor" title="Direct link to heading">#</a></h3><p><code>BlockProcessor</code> run once per new block, after all <code>MessageProcessor</code> functions have completed. </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><div tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:rgb(248, 248, 242)">@BlockProcessor</span><span class="token decorator annotation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token decorator annotation punctuation" style="color:rgb(248, 248, 242)">subscribe</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">priority</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">alertBlock</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;Finished processing messages for this block&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="startupprocessor"></a>StartUpProcessor<a class="hash-link" href="#startupprocessor" title="Direct link to heading">#</a></h3><p><code>StartUpProcessor</code> runs once on <code>counterblock</code> startup. </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><div tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:rgb(248, 248, 242)">@StartUpProcessor</span><span class="token decorator annotation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token decorator annotation punctuation" style="color:rgb(248, 248, 242)">subscribe</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">my_db_config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">my_db </span><span class="token operator">=</span><span class="token plain"> pymongo</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">Connection</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;my_db&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="caughtupprocessor"></a>CaughtUpProcessor<a class="hash-link" href="#caughtupprocessor" title="Direct link to heading">#</a></h3><p><code>CaughtUpProcessor</code> runs once when <code>counterblock</code> catches up to the latest Counterpartyd block. </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><div tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:rgb(248, 248, 242)">@CaughtUpProcessor</span><span class="token decorator annotation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token decorator annotation punctuation" style="color:rgb(248, 248, 242)">subscribe</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">caughtUpAlert</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;counterblock is now caught up to Counterpartyd!&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="rollbackprocessor"></a>RollbackProcessor<a class="hash-link" href="#rollbackprocessor" title="Direct link to heading">#</a></h3><p><code>RollbackProcessor</code> runs whenever the <code>counterblock</code> database is rolled back (either due to a blockchain
reorg, or an explicit rollback command being specified to <code>counterblock</code> via the command line).</p><p>Note that if this processor runs and <code>None</code> is passed as <code>max_block_index</code>, it means that there was a reparse of
all block data.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><div tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:rgb(248, 248, 242)">@RollbackProcessor</span><span class="token decorator annotation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token decorator annotation punctuation" style="color:rgb(248, 248, 242)">subscribe</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">rollbackAlert</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">max_block_index</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;counterblock block database rolled back! Anything newer than block index %i removed!&#x27;</span><span class="token plain"> </span><span class="token operator">%</span><span class="token plain"> max_block_index</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="other-integration-points"></a>Other integration points<a class="hash-link" href="#other-integration-points" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="configstate"></a>config.state<a class="hash-link" href="#configstate" title="Direct link to heading">#</a></h3><p>A number of internal state variables that a module may need to access are stored in <code>config.state</code>.</p><p>For example, if you want to run a process for every new block (but not when counterblock is catching up): </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><div tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:rgb(248, 248, 242)">@BlockProcessor</span><span class="token decorator annotation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token decorator annotation punctuation" style="color:rgb(248, 248, 242)">subscribe</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">my_custom_block_event</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">not</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;cpd_latest_block_index&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token plain"> </span><span class="token operator">-</span><span class="token plain"> config</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;my_latest_block&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;block_index&#x27;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">==</span><span class="token plain"> </span><span class="token number">1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">#Do stuff here</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="enhancing-the-api"></a>Enhancing the API<a class="hash-link" href="#enhancing-the-api" title="Direct link to heading">#</a></h3><p>To add an API method for <code>counterblock</code> to provide: </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><div tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> lib</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">processor </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> API</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">#(note that the dispatcher add_method does not take arguments) </span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:rgb(248, 248, 242)">@API</span><span class="token decorator annotation punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token decorator annotation punctuation" style="color:rgb(248, 248, 242)">add_method</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">my_foo_api_method</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">return</span><span class="token plain"> </span><span class="token string" style="color:rgb(255, 121, 198)">&#x27;bar&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Upon doing the above, <code>my_foo_api_method</code> is now a valid API method, and callable from any client that that utilizes your <code>counterblock</code> JSON RPC API.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="start_task"></a>start_task<a class="hash-link" href="#start_task" title="Direct link to heading">#</a></h3><p>To start a task that runs in a seperate lightweight thread (either immediately, or with a delay), use <code>start_task</code>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly python"><div tabindex="0" class="prism-code language-python codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">from</span><span class="token plain"> lib</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">processor </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">import</span><span class="token plain"> start_task</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">run_my_task</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">print</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">&quot;Foo bar!!&quot;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">#start again in 5 minutes</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        start_task</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">run_my_task</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> delay</span><span class="token operator">=</span><span class="token number">5</span><span class="token operator">*</span><span class="token number">60</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">        </span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">#start task the first time with no delay</span><span class="token plain"></span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">    start_task</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">run_my_task</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="module-configuration-file"></a>Module configuration file<a class="hash-link" href="#module-configuration-file" title="Direct link to heading">#</a></h2><p>After creating your module, you will need to tell <code>counterblock</code> about it, so that it can load it on startup. To do this, you should edit (or create) a file called <code>modules.conf</code> (or <code>modules.testnet.conf</code> for testnet), which should be located in the counterblock <code>config-dir</code> (<code>~xcp/.config/counterblock</code> on a federated node).</p><p>To load your custom module, specify the module&#x27;s path under <code>[LoadModule]</code> relative to the <code>counterblock base-dir</code>. i.e.:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">[LoadModule]</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">&#x27;lib/vendor&#x27; = True</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The above configuration would look for a <code>vendor.py</code>, or <code>vendor</code> folder (with required <code>__init__.py</code> file present), and load the plugin code from there. Note that you should not include any <code>.py</code> suffix on the filename.</p><p>To change the default behavior for <code>counterblock</code> modules/events, change the corresponding processor config. For instance:</p><p>To disable a processor:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">#(must be bool)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">[BlockProcessor]</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">generate_wallet_stats = False</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>To change a processor&#x27;s priority:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">#(must be int) </span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">[MessageProcessor]</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">parse_issuance = 5</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>To change priority and enable:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">#(tuple, order does not matter)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">[MessageProcessor]</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">parse_issuance = 5, True </span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">parse_issuance = True, 5</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Here&#x27;s an extensive <code>counterblock</code> <code>modules.conf</code> example config file:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">[MessageProcessor]</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">#Tweak core messaging processing</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"># (don&#x27;t use these unless you know what you&#x27;re doing)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">handle_exceptional = True</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">handle_invalid = True</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">parse_insert = True</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">handle_reorg = True</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">parse_issuance = 10, True</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">parse_balance_change = True</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">parse_trade_book = True</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">parse_broadcast = True</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">[StartUpProcessor]</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">#Enable/disable core functionality (all enabled by</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain"># default, don&#x27;t use these unless you know what you&#x27;re doing)</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">start_cpd_blockfeed = True</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">check_blockchain_service = True</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">expire_stale_orders = True</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">start_api = True</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">[LoadModule]</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">#Load custom modules</span></div><div class="token-line" style="color:#F8F8F2"><span class="token plain">lib/modules/reparse_timer = True</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Please note that function names must be exact.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="command-line-functions"></a>Command-line functions<a class="hash-link" href="#command-line-functions" title="Direct link to heading">#</a></h2><p>Counterblock also provides the ability to load/unload/disable/etc modules via the command line. (Although, please note that we recommend manually editing the appropriate <code>modules</code> config file(s), at least for starters.)</p><p>To enable a custom module, run the following command:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">counterblock enmod &#x27;lib/vendor&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>To disable a loaded module:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">counterblock dismod &#x27;lib/vendor&#x27; </span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>To list loaded modules and processors:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#F8F8F2;background-color:#282A36"><div class="token-line" style="color:#F8F8F2"><span class="token plain">counterblock listmod</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/facebook/docusaurus/edit/master/website/docs/develop/counterblock/modules.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/develop/counterblock/api"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Counterblock API</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/develop/contributing"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Contributing Â»</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#built-in-modules" class="table-of-contents__link">Built-in Modules</a></li><li><a href="#custom-module-development" class="table-of-contents__link">Custom Module Development</a><ul><li><a href="#processors-hooking-into-runtime-functionality" class="table-of-contents__link">Processors: Hooking into runtime functionality</a></li><li><a href="#messageprocessor" class="table-of-contents__link">MessageProcessor</a></li><li><a href="#mempoolmessageprocessor" class="table-of-contents__link">MempoolMessageProcessor</a></li><li><a href="#blockprocessor" class="table-of-contents__link">BlockProcessor</a></li><li><a href="#startupprocessor" class="table-of-contents__link">StartUpProcessor</a></li><li><a href="#caughtupprocessor" class="table-of-contents__link">CaughtUpProcessor</a></li><li><a href="#rollbackprocessor" class="table-of-contents__link">RollbackProcessor</a></li></ul></li><li><a href="#other-integration-points" class="table-of-contents__link">Other integration points</a><ul><li><a href="#configstate" class="table-of-contents__link">config.state</a></li><li><a href="#enhancing-the-api" class="table-of-contents__link">Enhancing the API</a></li><li><a href="#start_task" class="table-of-contents__link">start_task</a></li></ul></li><li><a href="#module-configuration-file" class="table-of-contents__link">Module configuration file</a></li><li><a href="#command-line-functions" class="table-of-contents__link">Command-line functions</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/basics/what-is-counterparty/a-bitcoin-protocol">Getting Started</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://discord.gg/wsjKtPGrMF" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord</a></li><li class="footer__item"><a href="https://counterpartytalk.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Forum</a></li><li class="footer__item"><a href="https://www.reddit.com/r/counterparty_xcp/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Reddit</a></li><li class="footer__item"><a href="https://t.me/Counterparty_XCP" target="_blank" rel="noopener noreferrer" class="footer__link-item">Telegram</a></li><li class="footer__item"><a href="https://twitter.com/CounterpartyXCP" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a href="https://github.com/CounterpartyXCP/Documentation" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2014 - 2021 My Project, Inc. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/styles.3bec8e7c.js"></script>
<script src="/assets/js/runtime~main.85ef5a3f.js"></script>
<script src="/assets/js/main.9a984a6f.js"></script>
<script src="/assets/js/1.d5f96000.js"></script>
<script src="/assets/js/2.51cf87d3.js"></script>
<script src="/assets/js/55.4d55144e.js"></script>
<script src="/assets/js/56.1e9741af.js"></script>
<script src="/assets/js/935f2afb.912e5501.js"></script>
<script src="/assets/js/17896441.cde37ae1.js"></script>
<script src="/assets/js/428d4327.b897686b.js"></script>
</body>
</html>